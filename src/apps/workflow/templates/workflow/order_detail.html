{% extends "base.html" %}

{% block content %}
    <div class="max-w-2xl justify-center px-10 md:px-5 mt-10 mx-auto" id="dfx-logs">
        <div class="p-4 md:p-6 border bg-white shadow-lg rounded-sm">

            <h2 class="text-gray-800 text-sm md:text-base font-regular mb-4 text-center border-b pb-1">Замовлення #<span class="font-bold">{{ order.id }}</span></h2>

            <div class="border-b pb-2 mb-4 font-regular">
              <h3 class="text-gray-800 text-xs md:text-sm"><span><span class="mdi mdi-clock-outline mr-2"></span>створено {{ order.created_at }}</span></h3>
              <h3 class="text-gray-800 text-xs md:text-sm"><span><span class="mdi mdi-clock-outline mr-2"></span>початок робіт {{ order.start_date }}</span></h3>
            </div>

            <ul class="flex flex-col mt-2 text-xs md:text-sm lg:text-base font-light">
                <li>Конфігурація: <span>{{ order.configuration|default:"----" }}</span></li>
                <li>Шамотування:  <span>{{ order.fireclay_type|default:"----" }}</span></li>
                <li>Скління:  <span>{{ order.glazing_type|default:"----" }}</span></li>
                <li>Рама:  <span>{{ order.frame_type|default:"----" }}</span></li>
                <li>Пріоритет:  <span>{{ order.priority|default:"----" }}</span></li>
                <li>Доставка:  <span>{{ order.delivery|default:"----" }}</span></li>
                <li>Номер телефону:  <span>{{ order.mobile_number|default:"----" }}</span></li>
                <li>E-mail:  <span>{{ order.email|default:"----" }}</span></li>
                <li>Оплата:  <span>{{ order.payment|default:"----" }}</span></li>

                <li>Нотатки:  <span>{{ order.notes.count|default:"жодної не додано." }}</span></li>
            </ul>

            <div class="border-b pb-1 mt-2 mb-2">
              <h2 class="text-gray-800 text-sm md:text-base font-normal mb-4 text-center border-b pb-1">Статуси замовлення</h2>
              {% for status in order.statuses.all %}
                <div class="text-gray-800 text-xs md:text-sm font-normal">
                  <div class="border-l border-l-2
                              {% if status.status.id == 2 %}border-green-700/50
                              {% elif status.status.id == 3 %}border-green-400/50
                              {% elif status.status.id == 4 %}border-red-800/50
                              {% else %}border-gray-500/50
                              {% endif %} space-y-2 my-2">
                      <div class="text-xs md:text-sm font-light ml-2 pl-2 flex flex-col">
                        <span class="flex"><span class="mdi mdi-clock-outline mr-2"></span>{{ status.created_at }}</span>
                        <span class="flex"><span class="mdi
                                                        {% if status.status.id == 2 %}mdi-check
                                                        {% elif status.status.id == 3 %}mdi-truck-delivery
                                                        {% elif status.status.id == 4 %}mdi-close
                                                        {% else %}mdi-hammer-wrench
                                                        {% endif %}mr-2"></span>{{ status.status.name }}</span>
                      </div>
                  </div>
                </div>
              {% empty %}
                <span class="text-xs md:text-sm lg:text-base font-light"> Поки що немає жодного.</span>
              {% endfor %}
            </div>

            <div class="border-b pb-1">
              <h2 class="text-gray-800 text-sm md:text-base font-normal mb-4 text-center border-b pb-1">Історія виконання</h2>
              {% regroup order.order_stages.all by order_of_execution as order_stages %}

              {% for order_stage in order_stages %}
                <div class="text-gray-800 text-xs md:text-sm font-normal">
                  <h4 class="font-semibold">{{ order_stage.grouper }} стадія</h4>
                  <div class="border-l border-l-2 border-gray-500 space-y-2 my-2">
                    {% for work_stage in order_stage.list %}
                      <h5 class="ml-2">{{ work_stage.stage.description }}</h5>
                      {% for log in work_stage.logs.all %}
                        <div class="text-xs md:text-sm font-light ml-2 pl-2 border-l border-l-1 border-gray-300 flex flex-col">
                          <span class="flex"><span class="mdi mdi-clock-outline mr-2"></span>{{ log.created_at }}</span>
                          <span class="flex"><span class="mdi mdi-account mr-2"></span>{{ log.user|default:"очікує призначення" }}</span>
                          <span class="flex"><span class="mdi mdi-hammer-wrench mr-2"></span>{{ log.stage|default:"створено задачу" }}</span>
                        </div>
                      {% endfor %}
                    {% endfor %}
                  </div>
                </div>
              {% empty %}
                <span class="text-xs md:text-sm lg:text-base font-light"> Поки що немає жодного.</span>
              {% endfor %}
            </div>

            <div class="flex flex-row justify-between text-sm md:text-base gap-2 mt-4">
              <a href="{% url 'workflow:order-notes' order.id %}"
                class="px-6
                      py-2.5
                      bg-blue-600
                      text-white
                      font-medium
                      text-xs
                      leading-tight
                      uppercase
                      rounded
                      shadow-md
                      hover:bg-blue-700 hover:shadow-lg
                      focus:bg-blue-700 focus:shadow-lg focus:outline-none focus:ring-0
                      active:bg-blue-800 active:shadow-lg active:text-white
                      transition
                      duration-150
                      ease-in-out
                      flex
                      items-center
                      whitespace-nowrap">
                Нотатки
              </a>
              <a href="{% url 'workflow:order-update' order.id %}"
                      class="px-6
                            py-2.5
                            bg-blue-600
                            text-white
                            font-medium
                            text-xs
                            leading-tight
                            uppercase
                            rounded
                            shadow-md
                            hover:bg-blue-700 hover:shadow-lg
                            focus:bg-blue-700 focus:shadow-lg focus:outline-none focus:ring-0
                            active:bg-blue-800 active:shadow-lg active:text-white
                            transition
                            duration-150
                            ease-in-out
                            flex
                            items-center
                            whitespace-nowrap">
                  Редагувати
              </a>
            </div>
        </div>
    </div>

{% endblock %}
